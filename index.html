
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calculadora de Daño de Espada — Botones de Incrementos</title>
<style>
  :root {
    --bg1: #0f172a; --bg2: #1e293b;
    --accent: #7c3aed; --accent-2: #22d3ee;
    --text: #e2e8f0; --muted: #94a3b8;
    --card: rgba(30,41,59,0.75); --border: rgba(226,232,240,0.15);
    --good: #10b981; --warn: #f59e0b; --bad: #ef4444;
  }
  * { box-sizing: border-box; }
  body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans'; color: var(--text);
    background: radial-gradient(1200px 600px at 15% 20%, #111827 30%, var(--bg1) 60%), radial-gradient(800px 500px at 85% 20%, #0b1324 30%, var(--bg2) 60%);
    min-height: 100vh; }
  header { padding: 32px 20px 12px; text-align: center; }
  h1 { font-size: 28px; margin: 0 0 6px; letter-spacing: 0.3px; }
  h3 { margin: 12px 0; }
  .subtitle { color: var(--muted); font-size: 14px; }
  .container { max-width: 1060px; margin: 24px auto 40px; padding: 0 20px; }
  .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; box-shadow: 0 20px 40px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.05); overflow: hidden; }
  .card-header { padding: 16px 20px; background: linear-gradient(90deg, rgba(124,58,237,0.12), rgba(34,211,238,0.12)); border-bottom: 1px solid var(--border); }
  .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 16px; padding: 20px; }
  .col-6 { grid-column: span 6; } .col-4 { grid-column: span 4; } .col-3 { grid-column: span 3; } .col-12 { grid-column: span 12; }
  @media (max-width: 900px) { .col-6, .col-4, .col-3 { grid-column: span 12; } }
  label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
  input, button { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: rgba(2,6,23,0.35); color: var(--text); outline: none; }
  input:focus { border-color: rgba(124,58,237,0.5); box-shadow: 0 0 0 3px rgba(124,58,237,0.15); }
  .row { display: flex; gap: 12px; }
  .btn { background: linear-gradient(135deg, var(--accent), var(--accent-2)); border: none; color: white; font-weight: 600; cursor: pointer; transition: transform .08s ease; }
  .btn:active { transform: scale(0.98); }
  .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); }
  .pill { display: inline-block; padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); font-size: 12px; color: var(--muted); }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; }
  .small { font-size: 12px; color: var(--muted); }
  .inc-wrap { display:flex; flex-wrap:wrap; gap:8px; }
  .inc-btn { display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border-radius:999px; border:1px solid var(--border); background: rgba(2,6,23,0.35); color:var(--text); cursor:pointer; }
  .inc-btn.active { border-color: rgba(124,58,237,0.7); box-shadow: 0 0 0 3px rgba(124,58,237,0.15); }
  .inc-remove { border:none; background:transparent; color:var(--muted); cursor:pointer; font-size:16px; line-height:1; padding:0 2px; }
  .result { padding:16px 20px; border-top:1px solid var(--border); background: linear-gradient(180deg, rgba(124,58,237,0.06), rgba(34,211,238,0.06)); }
</style>
</head>
<body>
  <header>
    <h1>Calculadora de Daño de Espada — Botones de Incrementos</h1>
    <div class="subtitle">Escalado por nivel + incrementos por <strong>botones</strong> (predeterminados y personalizados)</div>
  </header>

  <div class="container">
    <div class="card">
      <div class="card-header">
        <div class="row" style="align-items:center; justify-content:space-between;">
          <div>
            <span class="pill">Versión 2.1</span>
            <span class="pill">Modo científico</span>
          </div>
          <div class="small">Usa notación científica: mantisa × 10^exponente</div>
        </div>
      </div>

      <div class="grid">
        <div class="col-6">
          <h3>Daño inicial</h3>
          <label>Mantisa (1 ≤ m &lt; 10)</label>
          <input id="mantisa_inicial" type="number" min="1" max="10" step="0.001" value="2.067">
          <label>Exponente</label>
          <input id="expo_inicial" type="number" step="1" value="113">
        </div>
        <div class="col-6">
          <h3>Niveles</h3>
          <div class="row">
            <div style="flex:1">
              <label>Inicio</label>
              <input id="nivel_inicio" type="number" step="0.01" value="1312">
            </div>
            <div style="flex:1">
              <label>Fin</label>
              <input id="nivel_fin" type="number" step="0.01" value="2050">
            </div>
          </div>
          <label>Tasa por nivel (%)</label>
          <input id="tasa_nivel" type="number" step="0.001" value="8.52">
          <div class="small">Preajustes rápidos:</div>
          <div class="row" style="flex-wrap:wrap; gap:8px; margin-top:6px">
            <button class="btn" style="flex:1" data-rate="7.467" onclick="setRatePreset(this)">7.467 %</button>
            <button class="btn" style="flex:1" data-rate="8.52" onclick="setRatePreset(this)">8.52 %</button>
            <button class="btn" style="flex:1" data-rate="10" onclick="setRatePreset(this)">10 %</button>
            <button class="btn" style="flex:1" data-rate="12.2" onclick="setRatePreset(this)">12.2 %</button>
          </div>
        </div>

        <!-- Incrementos externos por botones -->
        <div class="col-12">
          <h3>Incrementos externos (por botones)</h3>
          <div class="small">Activa/Desactiva los incrementos. Puedes añadir nuevos y eliminarlos.</div>
          <div style="margin:8px 0">Predeterminados:</div>
          <div id="inc_buttons" class="inc-wrap"></div>
          <div class="row" style="margin-top:8px">
            <div style="flex:2">
              <label>Nuevo incremento (por ejemplo: <span class="mono">500 quatrillón</span>, <span class="mono">10 quintillones</span>, <span class="mono">1 sextillón</span>, <span class="mono">221331 %</span>)</label>
              <input id="nuevo_incremento" type="text" placeholder="Ej.: 500 quatrillón / 10 quintillones / 1 sextillón / 123 %">
            </div>
            <div style="flex:1; align-self:flex-end;">
              <button id="btn_add_inc" class="btn">Añadir incremento</button>
            </div>
            <div style="flex:1; align-self:flex-end;">
              <button id="btn_clear_custom" class="btn-outline">Eliminar personalizados</button>
            </div>
            <div style="flex:1; align-self:flex-end;">
              <button id="btn_toggle_all" class="btn-outline">Desactivar/Activar todos</button>
            </div>
          </div>
        </div>

        <div class="col-12">
          <h3>Resultado</h3>
          <div class="row">
            <div style="flex:1">
              <div id="salida_proyeccion" class="mono"></div>
              <div id="salida_incrementos" class="mono" style="margin-top:8px"></div>
            </div>
            <div style="flex:0 0 160px;">
              <button id="btn_calcular" class="btn">Calcular</button>
              <button id="btn_copiar" class="btn-outline" style="margin-top:8px">Copiar resultado</button>
            </div>
          </div>
          <div style="margin-top:8px">
            <span class="pill">Para porcentajes ≥ 10^6 %, se ignora el +1 por ser despreciable</span>
          </div>
        </div>
      </div>

      <div class="result">
        <div class="small">Consejo: usa la tasa del tramo real para respetar anclajes; los incrementos externos se aplican multiplicativamente.</div>
      </div>
    </div>
  </div>

<script>
// ===== Utilidades científicas =====
function normalize(ne){ let m=ne.m, e=ne.e; if(m===0) return {m:0,e:0}; const exp10=Math.floor(Math.log10(Math.abs(m))); m/=Math.pow(10,exp10); e+=exp10; if(m>=10){m/=10; e+=1;} if(m<1){m*=10;e-=1;} return {m,e}; }
function mult(a,b){ return normalize({m:a.m*b.m, e:a.e+b.e}); }
function fromNumber(x){ if(!isFinite(x)||x===0) return {m:0,e:0}; const e=Math.floor(Math.log10(Math.abs(x))); const m=x/Math.pow(10,e); return normalize({m,e}); }
function toString(ne,d=3){ if(ne.m===0) return "0"; return `${ne.m.toFixed(d)} × 10^${ne.e}`; }
function powFactor(ne,r,n){ const total=n*Math.log10(r); const eAdd=Math.floor(total); const mMult=Math.pow(10,total-eAdd); return normalize({m:ne.m*mMult, e:ne.e+eAdd}); }
function factorFromPercent(pct){ const absPct=Math.abs(pct); if(absPct>=1e6){ return fromNumber(absPct/100); } else { return fromNumber(1+(pct/100)); } }

// ===== Parseo de incrementos en texto =====
function parseExtremePercentToken(token){ const t=token.trim().toLowerCase(); if(!t) return null;
  const m1=t.match(/^([+-]?\\d+(?:[\\.,]\\d+)?)\\s*%$/); if(m1){ return parseFloat(m1[1].replace(',', '.')); }
  const m2=t.match(/^([+-]?\\d+(?:[\\.,]\\d+)?)\\s*(?:cuatrillon|cuatrillón|quatrillon|quatrillón)s?$/); if(m2){ return parseFloat(m2[1].replace(',', '.'))*1e15; }
  const m3=t.match(/^([+-]?\\d+(?:[\\.,]\\d+)?)\\s*(?:quintillon|quintillón|quintillones)s?$/); if(m3){ return parseFloat(m3[1].replace(',', '.'))*1e18; }
  const m4=t.match(/^([+-]?\\d+(?:[\\.,]\\d+)?)\\s*(?:sextillon|sextillón|sextillones)s?$/); if(m4){ return parseFloat(m4[1].replace(',', '.'))*1e21; }
  return null; }

// ===== UI de botones de incrementos =====
const presetPercents = [221331, 132, 39]; // en %
function renderIncrementButtons(){ const wrap=document.getElementById('inc_buttons'); wrap.innerHTML='';
  // Predeterminados
  presetPercents.forEach(p=>{ const btn=document.createElement('button'); btn.className='inc-btn active'; btn.dataset.pct=p; btn.dataset.kind='preset'; btn.textContent=`${p.toLocaleString('es-ES')} %`; btn.onclick=()=>toggleInc(btn); wrap.appendChild(btn); });
}
function toggleInc(btn){ const active = btn.classList.toggle('active'); btn.dataset.active = active ? '1' : '0'; calcular(); }
function addCustomIncrement(){ const txt=document.getElementById('nuevo_incremento').value; const pct=parseExtremePercentToken(txt); if(pct===null){ alert('Formato no reconocido. Usa % o cuatrillón/quintillón/sextillón.'); return; }
  const wrap=document.getElementById('inc_buttons'); const btn=document.createElement('button'); btn.className='inc-btn active'; btn.dataset.pct=pct; btn.dataset.kind='custom';
  const label = (Math.abs(pct)>=1e12) ? (()=>{ const ne=fromNumber(pct); return `${ne.m.toFixed(3)} × 10^${ne.e} %`; })() : `${pct.toLocaleString('es-ES')} %`;
  btn.innerHTML = `${label} <span class=\"inc-remove\" title=\"Eliminar\">×</span>`;
  btn.onclick = (ev)=>{ if(ev.target.classList.contains('inc-remove')){ btn.remove(); calcular(); } else { toggleInc(btn); } };
  wrap.appendChild(btn); document.getElementById('nuevo_incremento').value=''; calcular(); }
function clearCustom(){ document.querySelectorAll('.inc-btn[data-kind=\"custom\"]').forEach(el=>el.remove()); calcular(); }
function toggleAll(){ const anyActive = Array.from(document.querySelectorAll('.inc-btn')).some(el=>el.classList.contains('active'));
  document.querySelectorAll('.inc-btn').forEach(el=>{ if(anyActive){ el.classList.remove('active'); el.dataset.active='0'; } else { el.classList.add('active'); el.dataset.active='1'; } }); calcular(); }

// ===== Proyección + aplicación de incrementos activos =====
function calcular(){ const m0=parseFloat(document.getElementById('mantisa_inicial').value);
  const e0=parseInt(document.getElementById('expo_inicial').value,10);
  const L0=parseFloat(document.getElementById('nivel_inicio').value);
  const L1=parseFloat(document.getElementById('nivel_fin').value);
  const gPct=parseFloat(document.getElementById('tasa_nivel').value);
  if(!isFinite(m0)||!isFinite(e0)||!isFinite(L0)||!isFinite(L1)||!isFinite(gPct)||m0<=0){ return; }
  const nLevels=L1-L0; const r=1+(gPct/100);
  let D=normalize({m:m0,e:e0}); D=powFactor(D,r,nLevels);
  document.getElementById('salida_proyeccion').innerHTML = `<strong>Proyección (solo niveles):</strong> ${toString(D)}`;
  // Recoger incrementos activos
  const actives = Array.from(document.querySelectorAll('.inc-btn.active')).map(el=>parseFloat(el.dataset.pct));
  let Dinc = {m:D.m, e:D.e};
  actives.forEach(pct=>{ const f=factorFromPercent(pct); Dinc=mult(Dinc,f); });
  // Texto bonito de incrementos
  let pretty = '(ninguno)';
  if(actives.length>0){ pretty = actives.map(p=>{ if(Math.abs(p)>=1e12){ const ne=fromNumber(p); return `${ne.m.toFixed(3)} × 10^${ne.e} %`; } else { return `${p.toLocaleString('es-ES')} %`; } }).join(' + '); }
  document.getElementById('salida_incrementos').innerHTML = `<strong>Con incrementos activos:</strong> ${pretty} → ${toString(Dinc)}`;
}
function copiarResultado(){ const proy=document.getElementById('salida_proyeccion').innerText; const inc=document.getElementById('salida_incrementos').innerText; const texto=proy+"\n"+inc; navigator.clipboard.writeText(texto).then(()=>alert('Resultado copiado al portapapeles')); }
function setRatePreset(btn){ const rate=parseFloat(btn.dataset.rate); document.getElementById('tasa_nivel').value=rate; calcular(); }

// Eventos
window.addEventListener('DOMContentLoaded',()=>{
  renderIncrementButtons();
  document.getElementById('btn_add_inc').addEventListener('click', addCustomIncrement);
  document.getElementById('btn_clear_custom').addEventListener('click', clearCustom);
  document.getElementById('btn_toggle_all').addEventListener('click', toggleAll);
  document.getElementById('btn_calcular').addEventListener('click', calcular);
  document.getElementById('btn_copiar').addEventListener('click', copiarResultado);
  calcular();
});
</script>
</body>
</html>
